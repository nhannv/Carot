<div id="page-title">
	<div id="page-meta">
		<div class="aux-actions">
			<a class="btn btn-default btn-outline" ng-click="ngCtrl.deleteTreeModal()"><span translate="{{::'RECORD_TREE_DELETE'}}"></span></a>
		</div>
		<div class="meta-icon">
			<i class="fa fa-fw fa-sitemap fa-2x"></i>
		</div>
		<div class="meta-label">
			<div class="meta-label-aux">
				<span translate="{{::'RECORD_TREE_MANAGE_ATTRIBUTES'}}"></span>
				<span class="divider"><i class="fa fa-caret-right"></i></span>
				<span ng-bind="ngCtrl.entity.name"></span>
			</div>
			<h4 ng-bind="::ngCtrl.tree.name"></h4>
		</div>
	</div>
</div>
<div id="page-body">
	<div class="tabbable tabs-left spilled">
		<a class="back" href="#/admin/entities/{{::ngCtrl.entity.name}}/trees"><i class="fa fa-fw fa-arrow-left"></i> <span class="text" translate="{{::'BACK'}}"></span></a>
		<ul class="nav nav-tabs">
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}"><i class="fa fa-fw fa-info-circle"></i> <span class="text" translate="{{::'DETAILS'}}"></span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/fields"><i class="fa fa-fw fa-table"></i> <span class="text" translate="{{::'FIELDS'}}"></span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/views"><i class="fa fa-fw fa-file-text-o"></i> <span class="text" translate="{{::'RECORD_VIEWS'}}"></span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/lists"><i class="fa fa-fw fa-list"></i> <span class="text" translate="{{::'RECORD_LISTS'}}"></span></a></li>
			<li class="active"><a href="#/admin/entities/{{::ngCtrl.entity.name}}/trees"><i class="fa fa-fw fa-sitemap"></i> <span class="text" translate="{{::'RECORD_TREES'}}"></span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/relations"><i class="fa fa-fw fa-link"></i> <span class="text" translate="{{::'RELATIONS'}}"></span></a></li>
		</ul>

	</div>

	<div id="page-text">
		<div class="alert alert-warning ng-hide" ng-show="ngCtrl.tree.system">
			<i class="fa fa-fw fa-exclamation go-red"></i>
			<span translate="{{::'SYSTEM_ITEM_WARNING_TEXT'}}"></span>
		</div>
		<div class="view-manage-section">
			<h4 class="page-header" translate="{{::'RECORD_TREE_MANAGE_BASIC_HEADING'}}"></h4>
			<div class="panel panel-default">
				<div class="panel-body">
					<div class="form">
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'NAME'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-readonly">
												<input type="text" class="form-control" disabled value="{{::ngCtrl.tree.name}}">
												<span class="input-group-addon"><i class="fa fa-lock fa-fw"></i></span>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'LABEL'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-updatable" ng-dblclick="fieldForm_label.$show()">
												<input type="text" class="form-control" disabled editable-text="ngCtrl.tree.label"
													   value="{{ngCtrl.tree.label}}"
													   onbeforesave="ngCtrl.fieldUpdate('label',$data)" e-form="fieldForm_label">
												<span class="input-group-addon" ng-click="fieldForm_label.$show()" ng-hide="fieldForm_label.$visible"><i class="fa fa-pencil fa-fw"></i></span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'DEFAULT'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-updatable" ng-dblclick="fieldForm_default.$show()">
												<span class="input-group-addon hidden-xs" ng-if="ngCtrl.tree.default && !fieldForm_default.$visible">
													<i class="fa fa-check fa-fw go-green"></i>
												</span>
												<span class="input-group-addon hidden-xs" ng-if="!ngCtrl.tree.default && !fieldForm_default.$visible">
													<i class="fa fa-times fa-fw go-red"></i>
												</span>
												<input type="text" class="form-control" disabled editable-checkbox="ngCtrl.tree.default"
													   e-title="Make this default tree?" value="{{ngCtrl.tree.default}}"
													   onbeforesave="ngCtrl.fieldUpdate('default',$data)" e-form="fieldForm_default">
												<span class="input-group-addon" ng-click="fieldForm_default.$show()" ng-hide="fieldForm_default.$visible"><i class="fa fa-pencil fa-fw"></i></span>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'SYSTEM'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-readonly">
												<span class="input-group-addon" ng-if="ngCtrl.tree.system">
													<i class="fa fa-check fa-fw go-green"></i>
												</span>
												<span class="input-group-addon" ng-if="!ngCtrl.tree.system">
													<i class="fa fa-times fa-fw go-red"></i>
												</span>
												<input type="text" class="form-control" disabled value="{{::ngCtrl.tree.system}}">
												<span class="input-group-addon"><i class="fa fa-lock fa-fw"></i></span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'CSS_CLASS'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-updatable" ng-dblclick="fieldForm_cssClass.$show()">
												<input type="text" class="form-control" disabled editable-text="ngCtrl.tree.cssClass"
													   value="{{ngCtrl.tree.cssClass}}" onbeforesave="ngCtrl.fieldUpdate('cssClass', $data)" e-form="fieldForm_cssClass">
												<span class="input-group-addon" ng-click="fieldForm_cssClass.$show()" ng-hide="fieldForm_cssClass.$visible"><i class="fa fa-pencil fa-fw"></i></span>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'ICON_NAME'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-updatable" ng-dblclick="fieldForm_iconName.$show()">
												<span class="input-group-addon"><i class="fa fa-{{ngCtrl.tree.iconName}} fa-fw"></i></span>
												<input type="text" class="form-control" disabled editable-text="ngCtrl.tree.iconName" autocomplete="off"
													   value="{{ngCtrl.tree.iconName}}" onbeforesave="ngCtrl.fieldUpdate('iconName', $data)" e-form="fieldForm_iconName"
													   e-typeahead-template-url="iconTypeaheadTemplate.html" e-uib-typeahead="icon for icon in ngCtrl.icons | filter:$viewValue | limitTo:10">
												<span class="input-group-addon" ng-click="fieldForm_iconName.$show()" ng-hide="fieldForm_iconName.$visible"><i class="fa fa-pencil fa-fw"></i></span>
											</div>
											<div class="form-description" translate="{{::'ICON_NAME_DESCRIPTION'}}"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>

			<h4 class="page-header" translate="{{::'RECORD_TREE_OPTIONS'}}"></h4>
			<div class="panel panel-default">
				<div class="panel-body">
					<div class="form-horizontal">
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'RECORD_TREE_USED_RELATION'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-readonly">
												<span class="input-group-addon hidden-xs" ng-bind-html="::ngCtrl.getRelationBadgeHtml(ngCtrl.tree)"></span>
												<input type="text" class="form-control" disabled value="{{::ngCtrl.selectedRelation.name}}">
												<span class="input-group-addon"><i class="fa fa-lock fa-fw"></i></span>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'RECORD_TREE_DEPTH_LIMIT'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-updatable" ng-dblclick="fieldForm_depthLimit.$show()">
												<input type="text" class="form-control" disabled editable-text="ngCtrl.tree.depthLimit"
													   value="{{ngCtrl.tree.depthLimit}}"
													   onbeforesave="ngCtrl.fieldUpdate('depthLimit',$data)" e-form="fieldForm_depthLimit">
												<span class="input-group-addon" ng-click="fieldForm_depthLimit.$show()" ng-hide="fieldForm_depthLimit.$visible"><i class="fa fa-pencil fa-fw"></i></span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'RECORD_TREE_NODE_ID_FIELD'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-readonly">
												<input type="text" class="form-control" disabled value="{{::ngCtrl.nodeIdField.name}}" />
												<span class="input-group-addon"><i class="fa fa-lock fa-fw"></i></span>
											</div>
											<div class="form-description" translate="{{::'RECORD_TREE_NODE_ID_FIELD_DESCRIPTION'}}"></div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'RECORD_TREE_NODE_PARENT_ID_FIELD'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-readonly">
												<input type="text" class="form-control" disabled value="{{::ngCtrl.nodeParentIdField.name}}" />
												<span class="input-group-addon"><i class="fa fa-lock fa-fw"></i></span>
											</div>
											<div class="form-description" translate="{{::'RECORD_TREE_NODE_PARENT_ID_FIELD_DESCRIPTION'}}"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'RECORD_TREE_NODE_NAME_FIELD'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-updatable ng-hide" ng-show="::ngCtrl.nodeNameEligibleFields.length > 0"
												 ng-dblclick="fieldForm_nodeNameField.$show()">
												<input type="text" class="form-control" disabled editable-select="ngCtrl.nodeNameField"
													   value="{{ngCtrl.nodeNameField.name}}" e-ng-options="s as s.name for s in ngCtrl.nodeNameEligibleFields"
													   onbeforesave="ngCtrl.nodeNameUpdate($data)" e-form="fieldForm_nodeNameField">
												<span class="input-group-addon" ng-click="fieldForm_nodeNameField.$show()" ng-hide="fieldForm_nodeNameField.$visible"><i class="fa fa-pencil fa-fw"></i></span>
											</div>
											<div class="form-description ng-hide" ng-show="::ngCtrl.nodeNameEligibleFields.length > 0"></div>
											<div class="alert alert-danger ng-hide" ng-show="::ngCtrl.nodeNameEligibleFields.length == 0"></div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'RECORD_TREE_NODE_LABEL_FIELD'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-updatable ng-hide" ng-show="::ngCtrl.nodeLabelEligibleFields.length > 0"
												 ng-dblclick="fieldForm_nodeLabelField.$show()">
												<input type="text" class="form-control" disabled editable-select="ngCtrl.nodeLabelField"
													   value="{{ngCtrl.nodeLabelField.name}}" e-ng-options="s as s.name for s in ngCtrl.nodeLabelEligibleFields"
													   onbeforesave="ngCtrl.nodeLabelUpdate($data)" e-form="fieldForm_nodeLabelField">
												<span class="input-group-addon" ng-click="fieldForm_nodeLabelField.$show()" ng-hide="fieldForm_nodeLabelField.$visible"><i class="fa fa-pencil fa-fw"></i></span>
											</div>
											<div class="form-description ng-hide" ng-show="::ngCtrl.nodeLabelEligibleFields.length > 0" translate="{{::'RECORD_TREE_NODE_LABEL_FIELD_DESCRIPTION'}}"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<div class="editable-field field">
										<label class="control-label" translate="{{::'RECORD_TREE_NODE_WEIGHT_FIELD'}}"></label>
										<div>
											<div class="editable-wrapper input-group editable-updatable ng-hide" ng-show="::ngCtrl.nodeWeightEligibleFields.length > 0"
												 ng-dblclick="fieldForm_nodeWeightUpdate.$show()">
												<input type="text" class="form-control" disabled editable-select="ngCtrl.nodeWeightField"
													   value="{{ngCtrl.nodeWeightField.name}}" e-ng-options="s as s.name for s in ngCtrl.nodeWeightEligibleFields"
													   onbeforesave="ngCtrl.nodeWeightUpdate($data)" e-form="fieldForm_nodeWeightUpdate">
												<span class="input-group-addon" ng-click="fieldForm_nodeWeightUpdate.$show()" ng-hide="fieldForm_nodeWeightUpdate.$visible"><i class="fa fa-pencil fa-fw"></i></span>
											</div>
											<div class="form-description ng-hide" ng-show="::ngCtrl.nodeWeightEligibleFields.length > 0" translate="{{::'RECORD_TREE_NODE_WEIGHT_FIELD_DESCRIPTION'}}"></div>
											<div class="alert alert-danger ng-hide" ng-show="::ngCtrl.nodeWeightEligibleFields.length == 0" translate="{{::'RECORD_TREE_NODE_WEIGHT_FIELD_ALERT'}}"></div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-6">
							</div>
						</div>
					</div>
				</div>
			</div>

			<h4 class="page-header" style="margin-top:2em" translate="{{::'RECORD_TREE_ROOT_NODES_HEADING'}}"></h4>
			<div class="row" style="margin:0;">
				<div class="form-group col-sm-6" style="padding-left:0;">
					<div class="input-group">
						<input ng-model="ngCtrl.addRecordId" type="text" class="form-control" placeholder="record id" ng-keydown="ngCtrl.checkForAddEnter($event)">
						<span class="input-group-btn">
							<a href="javascript:void(0)" class="btn btn-default" ng-click="ngCtrl.addNewRootNodeById()"><i class="fa fa-fw fa-plus"></i> <span translate="{{::'ADD'}}"></span></a>
						</span>
					</div>
				</div>
			</div>
			<table class="table table-bordered ng-hide table-hover" ng-show="ngCtrl.tree.rootNodes.length>0">
				<thead>
					<tr>
						<th width="60" translate="{{::'ACTION'}}"></th>
						<th translate="{{::'RECORD_ID'}}"></th>
						<th translate="{{::'ID'}}"></th>
						<th translate="{{::'NAME'}}"></th>
						<th translate="{{::'LABEL'}}"></th>
						<th translate="{{::'PARENT_ID'}}"></th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="record in ngCtrl.tree.rootNodes track by record.id">
						<td><a class="btn btn-default btn-outline" href="javascript:void(0)" ng-click="ngCtrl.removeRootNode(record, $index)"><i class="fa fa-fw fa-times go-red"></i></a></td>
						<td>{{::record.recordId}}</td>
						<td>{{::record.id}}</td>
						<td>{{::record.name}}</td>
						<td>{{::record.label}}</td>
						<td>{{::record.parentId}}</td>
					</tr>
				</tbody>
			</table>
			<div class="alert alert-info ng-hide" ng-show="ngCtrl.tree.rootNodes.length==0" translate="{{::'RECORD_TREE_ROOT_NODES_MISSING_ALERT'}}"></div>

			<h4 class="page-header" style="margin-top:2em" translate="{{::'RECORD_TREE_NODE_OBJECT_PROPERTIES_HEADING'}}"></h4>
			<table class="table table-bordered table-hover">
				<thead>
					<tr>
						<th width="60" translate="{{::'ACTION'}}">action</th>
						<th translate="{{::'FIELD'}}">field</th>
						<th translate="{{::'TYPE'}}">type</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="field in ngCtrl.entity.fields track by field.id">
						<td ng-switch="ngCtrl.fieldSelectedBy(field)">
							<a ng-switch-when="system" class="btn btn-success disabled">
								<i class="fa fa-fw fa-lock"></i>
							</a>
							<a ng-switch-when="user" class="btn btn-success" href="javascript:void(0)" ng-click="ngCtrl.toggleFieldSelection(field)">
								<i class="fa fa-fw fa-check"></i>
							</a>
							<a ng-switch-when="none" class="btn btn-outline" href="javascript:void(0)" ng-click="ngCtrl.toggleFieldSelection(field)">
								<i class="fa fa-fw fa-check"></i>
							</a>
						</td>
						<td>{{::field.name}} </td>
						<td><span class="go-gray">{{::ngCtrl.getFieldType(field)}}</span></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<!--<pre>{{ngCtrl.tree | json}}</pre>-->
</div>


<script type="text/ng-template" id="deleteTreeModal.html">
	<div class="modal-header" id="modal-top">
		<button type="button" class="close" ng-click="popupCtrl.cancel('cancel')" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<h3 class="modal-title" translate="{{::'RECORD_TREE_DELETE_MODAL_TITLE'}}"></h3>
	</div>
	<div class="modal-body">
		<div class="alert alert-danger" ng-bind="popupCtrl.errorMessage" ng-show="popupCtrl.hasError"></div>
		<div ng-hide="popupCtrl.hasError">
			<p translate="{{::'RECORD_TREE_DELETE_MODAL_QUESTION'}}"></p>
		</div>
	</div>
	<div class="modal-footer">
		<button class="btn btn-danger" ng-click="popupCtrl.ok()" ng-hide="popupCtrl.hasError" translate="{{::'RECORD_TREE_DELETE'}}"></button>
		<button class="btn btn-default" ng-click="popupCtrl.cancel()" translate="{{::'CANCEL'}}"></button>
	</div>
</script>

<script type="text/ng-template" id="iconTypeaheadTemplate.html">
	<a class="typeahead-icon-item">
		<i class="fa fa-{{match.model}} fa-fw go-gray"></i>
		<span ng-bind-html="match.model | uibTypeaheadHighlight:query"></span>
	</a>
</script>