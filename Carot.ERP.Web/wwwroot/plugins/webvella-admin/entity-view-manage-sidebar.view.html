<div id="page-title">
	<div id="page-meta">
		<div class="aux-actions">

		</div>
		<div class="meta-icon">
			<i class="fa fa-fw fa-file-text-o fa-2x"></i>
		</div>
        <div class="meta-label">
			<div class="meta-label-aux">
				<span translate="{{::'RECORD_VIEW_MANAGE_SIDEBAR'}}"></span>
				<span class="divider"><i class="fa fa-caret-right"></i></span>
				<span ng-bind="ngCtrl.entity.name"></span>
			</div>
            <h4 ng-bind="::ngCtrl.view.name"></h4>
        </div>
	</div>
</div>
<div id="page-body">
	<div class="tabbable tabs-left spilled">
		<a class="back" href="#/admin/entities/{{::ngCtrl.entity.name}}/views"><i class="fa fa-fw fa-arrow-left"></i> <span class="text" translate="{{::'BACK'}}"></span></a>
		<ul class="nav nav-tabs">
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}"><i class="fa fa-fw fa-info-circle"></i> <span class="text" translate="{{::'DETAILS'}}"></span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/fields"><i class="fa fa-fw fa-table"></i> <span class="text" translate="{{::'FIELDS'}}"></span></a></li>
			<li class="active"><a href="#/admin/entities/{{::ngCtrl.entity.name}}/views"><i class="fa fa-fw fa-file-text-o"></i> <span class="text" translate="{{::'RECORD_VIEWS'}}"></span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/lists"><i class="fa fa-fw fa-list"></i> <span class="text" translate="{{::'RECORD_LISTS'}}"></span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/trees"><i class="fa fa-fw fa-sitemap"></i> <span class="text" translate="{{::'RECORD_TREES'}}"></span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/relations"><i class="fa fa-fw fa-link"></i> <span class="text" translate="{{::'RELATIONS'}}"></span></a></li>
		</ul>

	</div>
	<div id="page-text">
		<div class="alert alert-warning ng-hide" ng-show="ngCtrl.view.system">
			<i class="fa fa-fw fa-exclamation go-red"></i>
			<span translate="{{::'SYSTEM_ITEM_WARNING_TEXT'}}"></span>
		</div>
		<nav class="navbar navbar-default navbar-erp">
			<div class="container-fluid">
				<ul class="nav navbar-nav">
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}" translate="{{::'RECORD_VIEW_TAB_BASIC'}}"></a>
					</li>
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}/form" translate="{{::'RECORD_VIEW_TAB_MAIN_FORM'}}"></a>
					</li>
					<li role="presentation" class="active">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}/sidebar" translate="{{::'RECORD_VIEW_TAB_SIDEBAR_FORM'}}"></a>
					</li>
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}/actions" translate="{{::'RECORD_VIEW_TAB_ACTIONS'}}"></a>
					</li>
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}/data" translate="{{::'RECORD_VIEW_TAB_DATA'}}"></a>
					</li>
				</ul>
			</div>
		</nav>
		<div class="view-manage-section">
			<div class="row">
				<div class="col-xs-8">
					<h4 style="margin-bottom:1em;" translate="{{::'RECORD_VIEW_SIDEBAR_MANAGE_NOTE'}}"></h4>
				</div>
				<div class="col-xs-4">
					<h4 style="margin-bottom:1em;" translate="{{::'LIBRARY'}}"></h4>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-8">
					<div class="panel panel-default wrapper">
						<div class="drop-zone">
							<div as-sortable="ngCtrl.dragControlListeners" ng-model="ngCtrl.view.sidebar.items">
								<div class="dropped-item" ng-model="item" data-as-sortable-item ng-repeat="item in ngCtrl.view.sidebar.items track by item.dataName"
									ng-switch="::item.type">
									<div ng-switch-when="view">
										<i class="fa fa-fw fa-times go-red pull-right clickable" ng-click="ngCtrl.dragItemRemove(item.dataName)"></i>
										<i as-sortable-item-handle class="fa fa-fw fa-arrows go-gray"></i> <i class="fa fa-fw fa-file-text-o go-teal"></i> {{::item.meta.name}}
									</div>
									<div ng-switch-when="viewFromRelation">
										<i class="fa fa-fw fa-times go-red pull-right clickable" ng-click="ngCtrl.dragItemRemove(item.dataName)"></i>
										<i as-sortable-item-handle class="fa fa-fw fa-arrows go-gray"></i> <i class="fa fa-fw fa-file-text-o go-teal"></i> <span class="go-gray">
										<i class="fa fa-fw fa-cog pull-right clickable go-gray" ng-click="ngCtrl.manageFieldFromRelation(item)"></i> {{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}
									</div>
									<div ng-switch-when="list">
										<i class="fa fa-fw fa-times go-red pull-right clickable" ng-click="ngCtrl.dragItemRemove(item.dataName)"></i>
										<i as-sortable-item-handle class="fa fa-fw fa-arrows go-gray"></i> <i class="fa fa-fw fa-list go-teal"></i> {{::item.meta.name}}
									</div>
									<div ng-switch-when="listFromRelation">
										<i class="fa fa-fw fa-times go-red pull-right clickable" ng-click="ngCtrl.dragItemRemove(item.dataName)"></i>
										<i as-sortable-item-handle class="fa fa-fw fa-arrows go-gray"></i> <i class="fa fa-fw fa-list go-teal"></i> <span class="go-gray">
										<i class="fa fa-fw fa-cog pull-right clickable go-gray" ng-click="ngCtrl.manageFieldFromRelation(item)"></i>  {{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}
									</div>
									<div ng-switch-when="treeFromRelation">
										<i class="fa fa-fw fa-times go-red pull-right clickable" ng-click="ngCtrl.dragItemRemove(item.dataName)"></i>
										<i as-sortable-item-handle class="fa fa-fw fa-arrows go-gray"></i> <i class="fa fa-fw fa-sitemap go-teal"></i> <span class="go-gray">
											<i class="fa fa-fw fa-cog pull-right clickable go-gray" ng-click="ngCtrl.manageFieldFromRelation(item)"></i>  {{::item.relationName}}<span class="divider">></span>
										</span>{{::item.meta.name}}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-sm-4">
					<form class="form" style="margin-bottom:1em;padding:0;background:transparent;border:none;">
						<div class="form-group">
							<div class="input-group">
								<span class="input-group-addon"><i class="fa fa-fw fa-search"></i></span>
								<input type="text" ng-model="ngCtrl.search.dataName" class="form-control" style="width:100%;">
							</div>
						</div>
					</form>
					<div class="view-library section" style="height:200px;overflow-y:scroll;">
						<div class="drop-zone-disabled" id="library-items-list">
							<div as-sortable="ngCtrl.libraryDragControlListeners" ng-model="ngCtrl.library.items" id="library">
								<div class="dropped-item" data-as-sortable-item ng-model="item" 
									ng-repeat="item in ngCtrl.library.items | filter: ngCtrl.search track by item.dataName"
									ng-switch="::item.type">
									<div ng-switch-when="view"><i class="fa fa-fw fa-arrows go-gray" as-sortable-item-handle></i> <i class="fa fa-fw fa-file-text-o go-teal"></i> {{::item.meta.name}}</div>
									<div ng-switch-when="viewFromRelation"><i class="fa fa-fw fa-arrows go-gray" as-sortable-item-handle></i> <i class="fa fa-fw fa-file-text-o go-teal"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}</div>
									<div ng-switch-when="list"><i class="fa fa-fw fa-arrows go-gray" as-sortable-item-handle></i> <i class="fa fa-fw fa-list go-teal"></i> {{::item.meta.name}}</div>
									<div ng-switch-when="listFromRelation"><i class="fa fa-fw fa-arrows go-gray" as-sortable-item-handle></i> <i class="fa fa-fw fa-list go-teal"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}</div>
									<div ng-switch-when="treeFromRelation"><i class="fa fa-fw fa-arrows go-gray" as-sortable-item-handle></i> <i class="fa fa-fw fa-sitemap go-teal"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}</div>
								</div>
							</div>
						</div>
					</div>
					<br />
					<table class="table table-bordered ng-hide" ng-show="ngCtrl.library.relations.length > 0">
						<thead>
							<tr>
								<th class="go-bkg-white" translate="{{::'RELATIONS'}}"></th>
								<th width="90" class="go-bkg-white" translate="{{::'IN_LIBRARY'}}"></th>
								<th width="125" class="go-bkg-white" translate="{{::'DIRECTION'}}"></th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="relation in ngCtrl.library.relations track by relation.relationId">
								<td><div style="overflow-x:hidden;text-overflow:ellipsis;">
									<span ng-show="::ngCtrl.getRelationType(relation.relationId) == 1" class="badge badge-primary badge-inverse ng-hide" title="One to One" style="margin-right:5px;font-size:10px;">1 : 1</span>
									<span ng-show="::ngCtrl.getRelationType(relation.relationId) == 2" class="badge badge-primary badge-inverse ng-hide" title="One to Many" style="margin-right:5px;font-size:10px;">1 : N</span>
									<span ng-show="::ngCtrl.getRelationType(relation.relationId) == 3" class="badge badge-primary badge-inverse ng-hide" title="Many to Many" style="margin-right:5px;font-size:10px;">N : N</span>
									{{::relation.relationName}}
								</div></td>
								<td>
									<a ng-click="ngCtrl.toggleRelationToLibrary(relation)" href="javascript:void(0)" style="color:#2196F3 !important">
										<span class="ng-hide" ng-show="relation.addedToLibrary" translate="{{::'REMOVE'}}"></span>
										<span class="ng-hide" ng-show="!relation.addedToLibrary" translate="{{::'ADD'}}"></span>
									</a>
								</td>
								<td>
									<span class="go-gray" ng-if="!relation.sameOriginTargetEntity" title="{{::'RECORDS_RELATION_STATUS_TOOLTIP' | translate}}" translate="{{::'RECORDS_RELATION_STATUS_ORIGIN_NOT_TARGET'}}"></span>
									<a ng-click="ngCtrl.changeRelationDirection(relation)" href="javascript:void(0)" style="color:#2196F3 !important" ng-if="relation.sameOriginTargetEntity">
										<span class="ng-hide" ng-show="relation.direction == 'origin-target'" translate="{{::'RECORDS_RELATION_STATUS_ORIGIN_TO_TARGET'}}"></span>
										<span class="ng-hide" ng-show="relation.direction == 'target-origin'" translate="{{::'RECORDS_RELATION_STATUS_ORIGIN_FROM_TARGET'}}"></span>
									</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/ng-template" id="manageFromRelationModal.html">
	<div class="modal-header" id="modal-top">
		<button type="button" class="close" ng-click="popupCtrl.cancel('cancel')" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<h3 class="modal-title" translate="{{::'RECORD_VIEW_RELATION_ITEM_MANAGE_MODAL_TITLE'}}"></h3>
	</div>
	<div class="modal-body">
		<div class="alert alert-danger ng-hide" ng-show="popupCtrl.error">{{popupCtrl.errorMessage}}</div>
		<form class="form ng-hide" name="manageForm" ng-show="!popupCtrl.error">
			<div class="row">
				<div class="col-sm-6">
					<div class="form-group" ng-class="{ 'has-error' : manageForm.fieldLabel.$invalid && !manageForm.fieldLabel.$pristine || popupCtrl.fieldLabelError}">
						<label class="control-label required" translate="{{::'LABEL'}}"></label>
						<input class="form-control" ng-model="popupCtrl.field.fieldLabel" name="fieldLabel" type="text" ng-model-options="{allowInvalid:true}" required />
						<div class="error ng-hide" ng-show="manageForm.fieldLabel.$touched && manageForm.fieldLabel.$dirty && manageForm.fieldLabel.$invalid || popupCtrl.fieldLabelError">
							<small class="error ng-hide" ng-show="manageForm.fieldLabel.$error.required && !popupCtrl.fieldLabelError" translate="{{::'VALIDATION_REQUIRED_FIELD'}}"></small>
							<small class="error" ng-show="popupCtrl.fieldLabelError">
								{{popupCtrl.fieldLabelMessage}}
							</small>
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="form-group">
						<label for="requiredStatus" class="control-label" translate="{{::'REQUIRED'}}"></label>
						<div class="checkbox">
							<label>
								<input ng-model="popupCtrl.field.fieldRequired" type="checkbox" value="true">
								<span translate="{{::'REQUIRED_CHECKBOX_LABEL'}}"></span>
							</label>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-6">
					<div class="form-group" ng-class="{ 'has-error' : manageForm.fieldPlaceholder.$invalid && !manageForm.fieldPlaceholder.$pristine || popupCtrl.fieldPlaceholderError}">
						<label class="control-label" translate="{{::'PLACEHOLDER_TEXT'}}"></label>
						<input class="form-control" ng-model="popupCtrl.field.fieldPlaceholder" name="fieldPlaceholder" type="text" ng-model-options="{allowInvalid:true}" />
						<div class="error ng-hide" ng-show="manageForm.fieldPlaceholder.$touched && manageForm.fieldPlaceholder.$dirty && manageForm.fieldPlaceholder.$invalid || popupCtrl.fieldPlaceholderError">
							<small class="error" ng-show="popupCtrl.fieldPlaceholderError">
								{{popupCtrl.fieldPlaceholderMessage}}
							</small>
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="form-group" ng-class="{ 'has-error' : manageForm.fieldHelpText.$invalid && !manageForm.fieldHelpText.$pristine || popupCtrl.fieldHelpTextError}">
						<label class="control-label" translate="{{::'HELP_TEXT'}}"></label>
						<input class="form-control" ng-model="popupCtrl.field.fieldHelpText" name="fieldHelpText" type="text" ng-model-options="{allowInvalid:true}" />
						<div class="error ng-hide" ng-show="manageForm.fieldHelpText.$touched && manageForm.fieldHelpText.$dirty && manageForm.fieldHelpText.$invalid || popupCtrl.fieldHelpTextError">
							<small class="error ng-hide" ng-show="popupCtrl.fieldHelpTextError">
								{{popupCtrl.fieldHelpTextMessage}}
							</small>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-6">
					<div class="form-group">
						<label class="control-label required" translate="{{::'LOOKUP_LIST'}}"></label>
						<select class="form-control" ng-model="popupCtrl.field.fieldLookupList" ng-options="item.name as item.name for item in popupCtrl.lookupLists"></select>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="form-group" ng-if="popupCtrl.field.type == 'viewFromRelation' || popupCtrl.field.type == 'listFromRelation'">
						<label class="control-label required" translate="{{::'LIST_QUICK_CREATE'}}"></label>
						<select class="form-control" ng-model="popupCtrl.field.fieldManageView" ng-options="item.name as item.name for item in popupCtrl.quickCreateViews"></select>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary ng-hide" ng-show="!popupCtrl.error" ng-click="popupCtrl.ok()" translate="{{::'ADD'}}"></button>
		<button class="btn btn-default" ng-click="popupCtrl.cancel()" translate="{{::'CANCEL'}}"></button>
	</div>
</script>